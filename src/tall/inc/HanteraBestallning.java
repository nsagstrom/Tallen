/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package tall.inc;

import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.DefaultListModel;
import javax.swing.DefaultListSelectionModel;
import javax.swing.ListModel;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;

/**
 *
 * @author noahjarvback
 */
public class HanteraBestallning extends javax.swing.JFrame {

    /**
     * Creates new form HanteraBestallning
     */
    public HanteraBestallning() {
        initComponents();
        fillNamn();
        DefaultTableModel model = (DefaultTableModel) kundTbl.getModel();
        for (int i = kundTbl.getRowCount() - 1; i >= 0; i--) {
            model.removeRow(i);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        fornamnTxt = new javax.swing.JTextField();
        efternamnTxt = new javax.swing.JTextField();
        lblEfternamn = new javax.swing.JLabel();
        lblInfo = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        orderLista = new javax.swing.JList<>();
        jScrollPane2 = new javax.swing.JScrollPane();
        hattLista = new javax.swing.JList<>();
        valjBtn = new javax.swing.JButton();
        lblValjOrder = new javax.swing.JLabel();
        lblValjKund = new javax.swing.JLabel();
        lblTaBortHatt = new javax.swing.JLabel();
        lblFornamn = new javax.swing.JLabel();
        valjKundBtn = new javax.swing.JButton();
        uppdateraBtn = new javax.swing.JButton();
        btnTillbaka = new javax.swing.JButton();
        cmbFornamn = new javax.swing.JComboBox<>();
        jScrollPane3 = new javax.swing.JScrollPane();
        kundTbl = new javax.swing.JTable();
        btnOk = new javax.swing.JButton();

        fornamnTxt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                fornamnTxtActionPerformed(evt);
            }
        });

        efternamnTxt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                efternamnTxtActionPerformed(evt);
            }
        });

        lblEfternamn.setText("Efternamn:");

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        lblInfo.setFont(new java.awt.Font("Helvetica Neue", 0, 18)); // NOI18N
        lblInfo.setText("Ändra en beställning");

        jScrollPane1.setViewportView(orderLista);

        jScrollPane2.setViewportView(hattLista);

        valjBtn.setText("Välj");
        valjBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                valjBtnActionPerformed(evt);
            }
        });

        lblValjOrder.setFont(new java.awt.Font("Helvetica Neue", 0, 14)); // NOI18N
        lblValjOrder.setText("Välj ordernummer:");

        lblValjKund.setFont(new java.awt.Font("Helvetica Neue", 0, 14)); // NOI18N
        lblValjKund.setText("Välj kund:");

        lblTaBortHatt.setFont(new java.awt.Font("Helvetica Neue", 0, 14)); // NOI18N
        lblTaBortHatt.setText("Ta bort hatt från order:");

        lblFornamn.setText("Förnamn:");

        valjKundBtn.setText("Välj");
        valjKundBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                valjKundBtnActionPerformed(evt);
            }
        });

        uppdateraBtn.setText("Ta bort");
        uppdateraBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                uppdateraBtnActionPerformed(evt);
            }
        });

        btnTillbaka.setText("Tillbaka");
        btnTillbaka.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTillbakaActionPerformed(evt);
            }
        });

        cmbFornamn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbFornamnActionPerformed(evt);
            }
        });

        kundTbl.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Förnamn", "Efternamn", "Gata", "Tele"
            }
        ));
        jScrollPane3.setViewportView(kundTbl);

        btnOk.setText("Ok");
        btnOk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOkActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(23, 23, 23)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblValjOrder)
                            .addComponent(valjBtn))
                        .addGap(80, 80, 80)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(lblTaBortHatt)
                                .addContainerGap(534, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(uppdateraBtn)
                                .addGap(82, 82, 82)
                                .addComponent(btnTillbaka)
                                .addGap(0, 0, Short.MAX_VALUE))))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(76, 76, 76)
                                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(valjKundBtn)
                            .addComponent(lblInfo)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lblFornamn)
                                    .addComponent(lblValjKund)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(cmbFornamn, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(18, 18, 18)
                                        .addComponent(btnOk)))
                                .addGap(2, 2, 2)
                                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 266, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addContainerGap())))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(12, 12, 12)
                .addComponent(lblInfo)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lblValjKund)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblFornamn)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(cmbFornamn, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnOk)))
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 101, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(24, 24, 24)
                .addComponent(valjKundBtn)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblTaBortHatt, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(lblValjOrder))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(valjBtn)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(uppdateraBtn)
                        .addComponent(btnTillbaka)))
                .addGap(0, 75, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void valjKundBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_valjKundBtnActionPerformed
        // TODO add your handling code here:
        kundVald();

    }//GEN-LAST:event_valjKundBtnActionPerformed
    public void fillNamn() {
        String query = "SELECT distinct fornamn FROM kund";
        ArrayList<String> namn = SqlFragor.getEnKolumn(query);
        for (String namnen : namn) {
            cmbFornamn.addItem(namnen);
        }
    }
    private void kundVald()
    {
         int talet = kundTbl.getSelectedRow();

        TableModel model = kundTbl.getModel();
        String fornamn = (model.getValueAt(talet, 0).toString());
        String efternamn = (model.getValueAt(talet, 1).toString());
        String adress = (model.getValueAt(talet, 2).toString());
        String tel = (model.getValueAt(talet, 3).toString());

        String queryID = "select bestID from bestallning\n"
                +"join kund on kund.kundID = Bestallning.kundID\n"
                +"where fornamn = '" + fornamn + "' and efternamn\n"
                +"= '" + efternamn + "' and adress = '" + adress + "' and tel ='" + tel + "'";
        ArrayList<String> ID = SqlFragor.getEnKolumn(queryID);
     

        DefaultListModel model1 = new DefaultListModel();
        for (String order : ID) {
            model1.addElement(order);

            orderLista.setModel(model1);
        }
    }

    
    private void valjBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_valjBtnActionPerformed
        // TODO add your handling code here:
        String valdOrder = orderLista.getSelectedValue();
        String query = "select Beskrivning from Hatt\n"
                + "join orderrad on Hatt.HattID = Orderrad.HattID\n"
                + "join bestallning on Orderrad.BestID = Bestallning.BestID\n"
                + "where Bestallning.BestID = '" + valdOrder + "'";

        ArrayList<String> hattListan = SqlFragor.getEnKolumn(query);
        DefaultListModel model = new DefaultListModel();
        for (String hattar : hattListan) {
            model.addElement(hattar);

            hattLista.setModel(model);

    }//GEN-LAST:event_valjBtnActionPerformed
    }
//    private void uppdateraListan(String valdOrder){
//        
//        String query = "select Beskrivning from Hatt\n"
//                + "join orderrad on Hatt.HattID = Orderrad.HattID\n"
//                + "join bestallning on Orderrad.BestID = Bestallning.BestID\n"
//                + "where Bestallning.BestID = '" + valdOrder + "'";
//
//        ArrayList<String> hattListan = SqlFragor.getEnKolumn(query);
//        DefaultListModel model = new DefaultListModel();
//        for (String hattar : hattListan) {
//            model.addElement(hattar);
//
//            hattLista.setModel(model);
//    }
//    }
    private void uppdateraBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_uppdateraBtnActionPerformed
        // TODO add your handling code here:
        String valdOrder = orderLista.getSelectedValue();
        String valdHatt = hattLista.getSelectedValue();
        String query = "select RadID from Bestallning\n"
                + "join kund on Kund.KundID = Bestallning.KundID\n"
                + "join Orderrad on Bestallning.BestID = Orderrad.BestID\n"
                + "join Hatt on Hatt.HattID = Orderrad.HattID\n"
                + "and Bestallning.BestID = '" + valdOrder + "'\n"
                + "and Beskrivning = '" + valdHatt + "'";
        String radID = SqlFragor.getEttVarde(query);

        String deleteHatt = "DELETE FROM orderrad WHERE RadID = '" + radID + "'";
        SqlFragor.deleteFranDatabasen(deleteHatt);
        
        ListModel model = hattLista.getModel();
        
        if(model.getSize()==1){
           
            String deleteBest = "DELETE FROM BESTALLNING WHERE BESTID = '"  + valdOrder + "'"; 
            SqlFragor.deleteFranDatabasen(deleteBest);
        }
        
        new Startsida().setVisible(true);
        dispose();
    }//GEN-LAST:event_uppdateraBtnActionPerformed

    private void btnTillbakaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTillbakaActionPerformed
        // TODO add your handling code here:
        new Startsida().setVisible(true);
        dispose();
    }//GEN-LAST:event_btnTillbakaActionPerformed

    private void fornamnTxtActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_fornamnTxtActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_fornamnTxtActionPerformed

    private void efternamnTxtActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_efternamnTxtActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_efternamnTxtActionPerformed

    private void cmbFornamnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbFornamnActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cmbFornamnActionPerformed

    private void btnOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOkActionPerformed
        fyllInfo();
        ListModel model = new DefaultListModel();
        ListModel model1 = new DefaultListModel();
        orderLista.setModel(model);
        hattLista.setModel(model1);
        
        // TODO add your handling code here:
    }//GEN-LAST:event_btnOkActionPerformed

    private void fyllInfo() {
          DefaultTableModel model = (DefaultTableModel) kundTbl.getModel();
        for (int i = kundTbl.getRowCount() - 1; i >= 0; i--) {
            model.removeRow(i);
        }
        String namnet = cmbFornamn.getSelectedItem().toString();

        String testLista = "select kundid from kund where fornamn = '" + namnet + "'";
        ArrayList<String> lista = SqlFragor.getEnKolumn(testLista);
        System.out.println(lista);
        for (String listan : lista) {
            String queryForNamn = "select fornamn from kund where kundid = '" + listan + "'";
            String forNamn = SqlFragor.getEttVarde(queryForNamn);

            String queryEfterNamn = "select efternamn from kund where kundid = '" + listan + "'";
            String efterNamn = SqlFragor.getEttVarde(queryEfterNamn);

            String queryAdress = "select adress from kund where kundid = '" + listan + "'";
            String adress = SqlFragor.getEttVarde(queryAdress);

            String queryTele = "select tel from kund where kundid = '" + listan + "'";
            String tele = SqlFragor.getEttVarde(queryTele);

            String data[] = {forNamn, efterNamn, adress, tele};
            DefaultTableModel tblModel = (DefaultTableModel) kundTbl.getModel();
            tblModel.addRow(data);
        }
    }



    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnOk;
    private javax.swing.JButton btnTillbaka;
    private javax.swing.JComboBox<String> cmbFornamn;
    private javax.swing.JTextField efternamnTxt;
    private javax.swing.JTextField fornamnTxt;
    private javax.swing.JList<String> hattLista;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTable kundTbl;
    private javax.swing.JLabel lblEfternamn;
    private javax.swing.JLabel lblFornamn;
    private javax.swing.JLabel lblInfo;
    private javax.swing.JLabel lblTaBortHatt;
    private javax.swing.JLabel lblValjKund;
    private javax.swing.JLabel lblValjOrder;
    private javax.swing.JList<String> orderLista;
    private javax.swing.JButton uppdateraBtn;
    private javax.swing.JButton valjBtn;
    private javax.swing.JButton valjKundBtn;
    // End of variables declaration//GEN-END:variables
}
